<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Omar Mini App Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body{font-family:Arial;background:#f2f2f2;margin:0}
header{background:#0d6efd;color:#fff;padding:15px;text-align:center;font-size:22px}
.search{padding:10px}
input,select{width:100%;padding:10px;margin:5px 0;border-radius:6px;border:1px solid #ccc}
.app-card{background:#fff;margin:10px;padding:12px;border-radius:10px;box-shadow:0 2px 5px #ccc}
.app-card img{width:60px;height:60px}
.btn{background:#0d6efd;color:#fff;padding:8px 12px;border:none;border-radius:6px}
#adminPanel{display:none;background:#fff;padding:10px;margin:10px;border-radius:10px}
</style>
</head>

<body>

<header>üì± Omar Mini App Store</header>

<div class="search">
  <input type="text" id="search" placeholder="Search app..." />
  <select id="categoryFilter">
    <option value="">All Category</option>
    <option>Tools</option>
    <option>Video</option>
    <option>Storage</option>
  </select>
  <button class="btn" onclick="showAdmin()">Admin Login</button>
</div>

<div id="apps"></div>

<!-- Admin Panel -->
<div id="adminPanel">
  <h3>Add New App</h3>
  <input id="name" placeholder="App Name">
  <input id="icon" placeholder="Icon URL (raw png)">
  <input id="version" placeholder="Version">
  <input id="download" placeholder="APK Download Link">
  <select id="category">
    <option>Tools</option>
    <option>Video</option>
    <option>Storage</option>
  </select>
  <button class="btn" onclick="addApp()">Add App</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, onValue, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDwNphDJaRHpbKRBTlHshrKOqAAseNoBug",
  authDomain: "omarappstore-fa8c6.firebaseapp.com",
  databaseURL: "https://omarappstore-fa8c6-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "omarappstore-fa8c6",
  storageBucket: "omarappstore-fa8c6.firebasestorage.app",
  messagingSenderId: "300274754401",
  appId: "1:300274754401:web:111028e68d167ba4de5b20"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const appsRef = ref(db,"apps");
const adminPassRef = ref(db,"admin/password");
const container = document.getElementById("apps");

let cachedData = {};

// üîπ Load apps realtime
onValue(appsRef,(snap)=>{
  if(snap.exists()){
    cachedData = snap.val();
    renderApps();
  }
});

// üîπ Render apps with search & filter
function renderApps(){
  container.innerHTML="";
  const search = document.getElementById("search").value.toLowerCase();
  const cat = document.getElementById("categoryFilter").value;

  for(const key in cachedData){
    const a = cachedData[key];
    if(a.name.toLowerCase().includes(search) &&
      (cat==="" || a.category===cat)){
        container.innerHTML+=`
        <div class="app-card">
          <img src="${a.icon}">
          <h3>${a.name}</h3>
          <p>Version: ${a.version}</p>
          <p>Category: ${a.category}</p>
          <a href="${a.download}" target="_blank">
            <button class="btn">Download</button>
          </a>
        </div>`;
    }
  }
}

document.getElementById("search").addEventListener("keyup",renderApps);
document.getElementById("categoryFilter").addEventListener("change",renderApps);

// üîê Admin Login from Firebase password
window.showAdmin = async function(){
  const inputPass = prompt("Enter admin password:");
  const snap = await get(adminPassRef);
  if(snap.exists() && inputPass === snap.val()){
    document.getElementById("adminPanel").style.display="block";
  } else {
    alert("Wrong Password!");
  }
}

// ‚ûï Add App
window.addApp = function(){
  const appData = {
    name: name.value,
    icon: icon.value,
    version: version.value,
    download: download.value,
    category: category.value
  };
  push(appsRef, appData);
  alert("App Added Successfully!");
}
</script>

</body>
</html>
